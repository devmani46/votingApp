<div class="campaign-container">
  <div class="header">
    <app-burger-menu></app-burger-menu>
    <h2>{{ editMode ? "Edit Campaign" : "Create Campaign" }}</h2>
    <img class="admin-photo" src="/assets/admin.png" alt="Admin" />
  </div>

  <div class="create-form">
    <form [formGroup]="form" (ngSubmit)="submitForm()">
      <div class="photo-divide">
        <app-fui-input
          class="campaign-title"
          size="large"
          formControlName="title"
          placeholder="Campaign Title"
        ></app-fui-input>

        <div class="two-inputs">
          <textarea
            class="description-box"
            formControlName="description"
            placeholder="Campaign Description"
          ></textarea>
        </div>

        <div class="add-candidates row">
          <label>Candidates</label>
          <app-button appearance="primary" (click)="openDialog()"
            >Add</app-button
          >
        </div>

        <div class="candidates-list">
          @for (c of candidates.controls; let i = $index; track i) {
          <div class="candidate-card-wrapper" (click)="openDialog(i)">
            <button
              class="delete-btn"
              type="button"
              (click)="deleteCandidate(i); $event.stopPropagation()"
            >
              ✕
            </button>

            <app-campaign-card
              [title]="c.value.name"
              [description]="c.value.bio"
              [image]="c.value.photo"
              size="medium"
            >
            </app-campaign-card>
          </div>
          }
        </div>

        @if (showDialog) {
        <div class="dialog">
          <div class="dialog-content">
            <h3>
              {{ editIndex !== null ? "Edit Candidate" : "Add Candidate" }}
            </h3>

            <div class="candidate-form">
              <div class="candidate-form-divided">
                <div class="candidate-photo-upload">
                  <input
                    type="file"
                    accept="image/*"
                    (change)="onCandidatePhotoSelected($event)"
                    hidden
                    #candidateFile
                  />
                  <button
                    class="choose-photo-btn"
                    (click)="candidateFile.click()"
                  >
                    @if (candidatePhotoPreview) {
                    <img
                      class="candidate-photo"
                      [src]="candidatePhotoPreview"
                      alt="Candidate Photo"
                    />
                    } @else {
                    <span class="material-symbols-outlined"
                      >add_photo_alternate</span
                    >
                    <h2>Add Photo</h2>
                    }
                  </button>
                </div>

                <div class="candidate-details">
                  <app-fui-input
                    [formControl]="nameControl"
                    placeholder="Name"
                  ></app-fui-input>

                  <textarea
                    class="bio-box"
                    [formControl]="bioControl"
                    placeholder="Bio"
                  ></textarea>

                  <div class="properties">
                    <div class="row">
                      <app-fui-input
                        [formControl]="propertyControl"
                        placeholder="Property"
                      ></app-fui-input>
                      <app-button appearance="primary" (click)="addProperty()">
                        Add
                      </app-button>
                    </div>

                    <ul>
                      @for (p of candidateProperties; let j = $index; track j) {
                      <li>
                        {{ p }}
                        <span class="remove-prop" (click)="removeProperty(j)"
                          >✕</span
                        >
                      </li>
                      }
                    </ul>
                  </div>
                </div>
              </div>
            </div>

            <div class="dialog-actions">
              <app-button appearance="secondary" (click)="closeDialog()">
                Cancel
              </app-button>
              <app-button appearance="primary" (click)="saveCandidate()">
                Save
              </app-button>
            </div>
          </div>
        </div>
        }

        <div class="row">
          <div class="start-date">
            <label>Start Date:</label>
            <input type="date" formControlName="startDate" />
          </div>
          <div class="end-date">
            <label>End Date:</label>
            <input type="date" formControlName="endDate" />
          </div>
        </div>

        <app-button type="submit" appearance="primary">
          {{ editMode ? "Update Campaign" : "Create Campaign" }}
        </app-button>
      </div>
      <div class="row add-banner">
        <input
          type="file"
          accept="image/*"
          (change)="onLogoSelected($event)"
          hidden
          #logoInput
        />
        <button class="image-upload" type="button" (click)="logoInput.click()">
          @if (logoPreview) {
          <div class="logo-preview">
            <img [src]="logoPreview" alt="Campaign Logo" />
          </div>
          } @else {
          <span class="material-symbols-outlined">add_photo_alternate</span>
          <p>Add banner photo</p>
          }
        </button>
      </div>
    </form>
  </div>
</div>
