<div class="moderator-management">
  <div class="header">
    <app-burger-menu></app-burger-menu>
    <h2>Moderator Management</h2>
    <img class="admin-photo" src="/assets/admin.png" alt="Admin" />
  </div>

  <div class="section">
    <div class="section-header" style="display: flex; justify-content: space-between; align-items: center;">
      <h3>Moderators</h3>
      <div style="display: flex; gap: 0.5rem; align-items: center;">
        <app-fui-input
          placeholder="Search by name/email"
          [formControl]="searchControl"
        ></app-fui-input>
        <app-button appearance="primary" (click)="openDialog()">Add Moderator</app-button>
      </div>
    </div>

    <div class="sort-controls" style="margin: 0.5rem 0;">
      <span>Sort by: </span>
      <app-button size="small" appearance="outline" (click)="changeSort('name')">
        Name {{ sortField === 'name' ? (sortDirection === 'asc' ? '↑' : '↓') : '' }}
      </app-button>
      <app-button size="small" appearance="outline" (click)="changeSort('email')">
        Email {{ sortField === 'email' ? (sortDirection === 'asc' ? '↑' : '↓') : '' }}
      </app-button>
    </div>

    <div class="moderator-list">
      @if (filteredModerators.length === 0) {
        <p>No moderators found.</p>
      } @else {
        @for (mod of filteredModerators; let i = $index; track i) {
        <div class="moderator-card">
          <div class="info">
            <p><strong>{{ mod.name }}</strong></p>
            <p>{{ mod.email }}</p>
          </div>
          <div class="actions">
            <app-button size="small" appearance="secondary" (click)="openDialog(i)">Edit</app-button>
            <app-button size="small" appearance="primary" (click)="deleteModerator(i)">Delete</app-button>
          </div>
        </div>
        }
      }
    </div>
  </div>

  @if (showDialog) {
  <div class="dialog-backdrop" (click)="closeDialogOnBackdrop($event)">
    <div class="dialog-content" (click)="$event.stopPropagation()">
      <h3>{{ editIndex !== null ? "Edit Moderator" : "Add Moderator" }}</h3>

      <div class="moderator-form">
        <label>Name</label>
        <app-fui-input [formControl]="nameControl" placeholder="Moderator Name"></app-fui-input>

        <label>Email</label>
        <app-fui-input [formControl]="emailControl" placeholder="Moderator Email"></app-fui-input>

        <label>Password</label>
        <app-fui-input [formControl]="passwordControl" type="password" placeholder="Password"></app-fui-input>
      </div>

      <div class="dialog-actions">
        <app-button appearance="secondary" (click)="closeDialog()">Cancel</app-button>
        <app-button appearance="primary" (click)="saveModerator()">Save</app-button>
      </div>
    </div>
  </div>
  }
</div>
