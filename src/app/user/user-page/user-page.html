<app-nav-bar></app-nav-bar>

<div class="user-page-container">
  <div class="welcome-section">
    <img
      class="profile-photo"
      [src]="user.photo || '/assets/default-user.png'"
      alt="User Photo"
    />
    <div class="welcome-text">
      <h2>Welcome, {{ user.firstName }} {{ user.lastName }}</h2>
      <p><strong>Age:</strong> {{ user.age }}</p>
      <p><strong>Country:</strong> {{ user.country }}</p>
    </div>
    <app-button appearance="primary" (click)="openDialog()">Edit Profile</app-button>
  </div>

  @if (showDialog) {
  <div class="dialog-backdrop" (click)="closeDialogOnBackdrop($event)">
    <div class="dialog-content" (click)="$event.stopPropagation()">
      <h3>Edit Profile</h3>

      <form [formGroup]="form">
        <div class="photo-upload">
          <input type="file" accept="image/*" (change)="onPhotoSelected($event)" hidden #fileInput />
          <button type="button" class="choose-photo-btn" (click)="fileInput.click()">
            @if (photoPreview) {
            <img class="profile-photo-preview" [src]="photoPreview" alt="Profile Photo" />
            } @else {
            <span class="material-symbols-outlined">add_photo_alternate</span>
            <p>Add Photo</p>
            }
          </button>
        </div>

        <label>First Name</label>
        <app-fui-input formControlName="firstName" placeholder="First Name"></app-fui-input>

        <label>Last Name</label>
        <app-fui-input formControlName="lastName" placeholder="Last Name"></app-fui-input>

        <label>Date of Birth</label>
        <input type="date" formControlName="dob" (change)="updateAge()" />

        <label>Country</label>
        <app-combobox
          [options]="countries"
          [multiple]="false"
          placeholder="Select Country"
          (valueChange)="onCountryChange($event)">
        </app-combobox>

        <label>Email</label>
        <app-fui-input formControlName="email" type="text" placeholder="Email"></app-fui-input>

        <label>Password (leave blank to keep current)</label>
        <app-fui-input formControlName="password" type="password" placeholder="Password"></app-fui-input>

        <label>Confirm Password</label>
        <app-fui-input formControlName="confirmPassword" type="password" placeholder="Confirm Password"></app-fui-input>

        <div class="dialog-actions">
          <app-button appearance="secondary" (click)="closeDialog()">Cancel</app-button>
          <app-button appearance="primary" (click)="saveProfile()">Confirm</app-button>
        </div>
      </form>
    </div>
  </div>
  }
</div>

<app-footer></app-footer>
