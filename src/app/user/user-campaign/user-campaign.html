<app-nav-bar></app-nav-bar>

<div class="user-campaign-page">
  <div class="past-campaigns">
    <h2>Past Campaigns</h2>
    @if (pastCampaigns().length === 0) {
      <p>There are no past campaigns yet.</p>
    } @else {
      <div class="campaign-list">
        @for (c of pastCampaigns().slice(0, showAllPast ? pastCampaigns().length : INITIAL_DISPLAY_COUNT); track c.id) {
          <app-campaign-card
            [id]="c.id"
            [title]="c.title"
            [description]="c.description"
            [image]="c.banner_url || '/assets/admin.png'"
            size="small"
            (click)="openCampaignDetails(c)"
          >
            <div class="campaign-winner">
              <strong>Winner:</strong>
              @if (c.winner) {
                @if (!c.winner.draw) {
                  {{ c.winner.candidates[0].name }}
                } @else {
                  Draw between {{ getDrawNames(c) }}
                }
              } @else {
                <em>No winner determined yet.</em>
              }
            </div>
          </app-campaign-card>
        }
      </div>
      @if (pastCampaigns().length > INITIAL_DISPLAY_COUNT) {
        <div class="view-toggle">
          @if (!showAllPast) {
            <app-button appearance="primary" (click)="togglePast()">View More</app-button>
          } @else {
            <app-button appearance="secondary" (click)="togglePast()">View Less</app-button>
          }
        </div>
      }
    }
  </div>

  <div class="available-campaigns">
    <h2>Available Campaigns</h2>

    <div class="campaign-list">
      @if (campaigns().length === 0) {
      <p>No campaigns available.</p>
      } @else { @for (c of campaigns().slice(0, showAllAvailable ? campaigns().length : INITIAL_DISPLAY_COUNT); track c.id) {
      <app-campaign-card
        [id]="c.id"
        [title]="c.title"
        [description]="c.description"
        [image]="c.banner_url || '/assets/admin.png'"
        size="medium"
        (click)="openCampaign(c.id)"
      >
      </app-campaign-card>
      } }
    </div>
    @if (campaigns().length > INITIAL_DISPLAY_COUNT) {
      <div class="view-toggle">
        @if (!showAllAvailable) {
          <app-button appearance="primary" (click)="toggleAvailable()">View More</app-button>
        } @else {
          <app-button appearance="secondary" (click)="toggleAvailable()">View Less</app-button>
        }
      </div>
    }
  </div>

  <div class="upcoming-campaigns">
    <h2>Upcoming Campaigns</h2>

    <div class="campaign-list">
      @if (upcomingCampaigns().length === 0) {
      <p>No upcoming campaigns.</p>
      } @else {
        @for (c of upcomingCampaigns().slice(0, showAllUpcoming ? upcomingCampaigns().length : INITIAL_DISPLAY_COUNT); track c.id) {
          <app-campaign-card
            [id]="c.id"
            [title]="c.title"
            [description]="c.description"
            [image]="c.banner_url || '/assets/admin.png'"
            size="medium"
          >
          </app-campaign-card>
        }
      }
    </div>
    @if (upcomingCampaigns().length > INITIAL_DISPLAY_COUNT) {
      <div class="view-toggle">
        @if (!showAllUpcoming) {
          <app-button appearance="primary" (click)="toggleUpcoming()">View More</app-button>
        } @else {
          <app-button appearance="secondary" (click)="toggleUpcoming()">View Less</app-button>
        }
      </div>
    }
  </div>

  @if (selectedCampaign) {
    <div class="dialog-backdrop" (click)="closeCampaignDialog($event)">
      <div class="dialog-content" (click)="$event.stopPropagation()">
        <h2>{{ selectedCampaign.title }}</h2>
        <p>{{ selectedCampaign.description }}</p>
        <div class="winner-section">
          <h3>Winner:</h3>
          @if (winner) {
            @if (!winner.draw) {
              <div class="winner-card">
                <img [src]="getWinnerPhotoUrl(winner.candidates[0])" alt="Winner Photo" class="winner-photo" />
                <div class="winner-info">
                  <p><strong>Name:</strong> {{ winner.candidates[0].name }}</p>
                  <p><strong>Bio:</strong> {{ winner.candidates[0].bio || "No bio available." }}</p>
                  <p><strong>Total Votes:</strong> {{ winner.candidates[0].votes }}</p>
                </div>
              </div>
            } @else {
              <p><strong>It's a draw between:</strong> {{ getDrawNames(selectedCampaign) }}</p>
              <div class="draw-candidates">
                @for (cand of winner.candidates; track cand.name) {
                  <div class="winner-card">
                    <img [src]="getWinnerPhotoUrl(cand)" alt="Candidate Photo" class="winner-photo" />
                    <div class="winner-info">
                      <p><strong>Name:</strong> {{ cand.name }}</p>
                      <p><strong>Bio:</strong> {{ cand.bio || "No bio available." }}</p>
                      <p><strong>Total Votes:</strong> {{ cand.votes }}</p>
                    </div>
                  </div>
                }
              </div>
            }
          } @else {
            <em>No winner determined yet.</em>
          }
        </div>
        <div class="dialog-actions">
          <app-button appearance="secondary" (click)="closeCampaignDialog()">Close</app-button>
        </div>
      </div>
    </div>
  }
</div>
<app-footer></app-footer>
